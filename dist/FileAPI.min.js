/*! 12.2.17 */

!function(e){"use strict";var a=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,s=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),l=s&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),u=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,i=(s||u)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,n,a,i,r,o;for(t=0<=e.split(",")[0].indexOf("base64")?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),n=new ArrayBuffer(t.length),a=new Uint8Array(n),i=0;i<t.length;i+=1)a[i]=t.charCodeAt(i);return r=e.split(",")[0].split(":")[1].split(";")[0],s?new Blob([l?a:n],{type:r}):((o=new u).append(n),o.getBlob(r))};e.HTMLCanvasElement&&!a.toBlob&&(a.mozGetAsFile?a.toBlob=function(e,t,n){n&&a.toDataURL&&i?e(i(this.toDataURL(t,n))):e(this.mozGetAsFile("blob",t))}:a.toDataURL&&i&&(a.toBlob=function(e,t,n){e(i(this.toDataURL(t,n)))})),e.dataURLtoBlob=i}(window),function(i,o){"use strict";var t=1,m=function(){},a=i.document,e=a.doctype||{},n=i.navigator.userAgent,s=i.createObjectURL&&i||i.URL&&URL.revokeObjectURL&&URL||i.webkitURL&&webkitURL,r=i.Blob,l=i.File,u=i.FileReader,c=i.FormData,f=i.XMLHttpRequest,d=i.jQuery,p=!(!(l&&u&&(i.Uint8Array||c||f.prototype.sendAsBinary))||/safari\//i.test(n)&&!/chrome\//i.test(n)&&/windows/i.test(n)),h=p&&"withCredentials"in new f,g=p&&!!r&&!!(r.prototype.webkitSlice||r.prototype.mozSlice||r.prototype.slice),v=i.dataURLtoBlob,y=/img/i,w=/canvas/i,b=/img|canvas/i,A=/input/i,x=/^data:[^,]+,/,I={}.toString,F=i.Math,R=function(e){return(e=new i.Number(F.pow(1024,e))).from=function(e){return F.round(e*this)},e},T={},_=[],C="abort progress error load loadend",P="status statusText readyState response responseXML responseText responseBody".split(" "),E="currentTarget",D="preventDefault",U=function(e){return e&&"length"in e},k=function(e,t,n){if(e)if(U(e))for(var a=0,i=e.length;a<i;a++)a in e&&t.call(n,e[a],a,e);else for(var r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)},L=function(n){for(var e=arguments,t=1,a=function(e,t){n[t]=e};t<e.length;t++)k(e[t],a);return n},B=function(t,e,n){if(t){var a=H.uid(t);T[a]||(T[a]={});var i=u&&t&&t instanceof u;k(e.split(/\s+/),function(e){d&&!i?d.event.add(t,e,n):(T[a][e]||(T[a][e]=[]),T[a][e].push(n),t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n)})}},S=function(a,e,i){if(a){var t=H.uid(a),r=T[t]||{},o=u&&a&&a instanceof u;k(e.split(/\s+/),function(e){if(d&&!o)d.event.remove(a,e,i);else{for(var t=r[e]||[],n=t.length;n--;)if(t[n]===i){t.splice(n,1);break}a.addEventListener?a.removeEventListener(e,i,!1):a.detachEvent?a.detachEvent("on"+e,i):a["on"+e]=null}})}},j=function(n,a,i){B(n,a,function e(t){S(n,a,e),i(t)})},z=function(e){return e.target||(e.target=i.event&&i.event.srcElement||a),3===e.target.nodeType&&(e.target=e.target.parentNode),e},M=function(e){var t=a.createElement("input");return t.setAttribute("type","file"),e in t},H={version:"2.0.7",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(e,t){return e+(null!=t?"["+t+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5e3,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:R(1),MB:R(2),GB:R(3),TB:R(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[H.expando]=e[H.expando]||H.uid():(++t,H.expando+t)},log:function(){H.debug&&H._supportConsoleLog&&(H._supportConsoleLogApply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(e,t){var n=a.createElement("img");return t&&H.event.one(n,"error load",function(e){t("error"==e.type,n),n=null}),n.src=e,n},getXHR:function(){var t;if(f)t=new f;else if(i.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},isArray:U,support:{dnd:h&&"ondrop"in a.createElement("div"),cors:h,html5:p,chunked:g,dataURI:!0,accept:M("accept"),multiple:M("multiple")},event:{on:B,off:S,one:j,fix:z},throttle:function(e,t){var n,a;return function(){a=arguments,n||(e.apply(i,a),n=setTimeout(function(){n=0,e.apply(i,a)},t))}},F:function(){},parseJSON:function(e){return i.JSON&&JSON.parse?JSON.parse(e):new Function("return ("+e.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(e){return(e=String(e)).trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function(){var n,a,i=[],r={resolve:function(e,t){for(r.resolve=m,a=e||!1,n=t;t=i.shift();)t(a,n)},then:function(e){a!==o?e(a,n):i.push(e)}};return r},queue:function(e){var t=0,n=0,a=!1,i=!1,r={inc:function(){n++},next:function(){t++,setTimeout(r.check,0)},check:function(){n<=t&&!a&&r.end()},isFail:function(){return a},fail:function(){!a&&e(a=!0)},end:function(){i||(i=!0,e())}};return r},each:k,afor:function(t,n){var a=0,i=t.length;U(t)&&i--?function e(){n(i!=a&&e,t[a],a++)}():n(!1)},extend:L,isFile:function(e){return"[object File]"===I.call(e)},isBlob:function(e){return this.isFile(e)||"[object Blob]"===I.call(e)},isCanvas:function(e){return e&&w.test(e.nodeName)},getFilesFilter:function(e){return(e="string"==typeof e?e:e.getAttribute&&e.getAttribute("accept")||"")?new RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){H.isCanvas(e)?O(e,t,"load",H.toDataURL(e)):q(e,t,"DataURL")},readAsBinaryString:function(e,n){N("BinaryString")?q(e,n,"BinaryString"):q(e,function(t){if("load"==t.type)try{t.result=H.toBinaryString(t.result)}catch(e){t.type="error",t.message=e.toString()}n(t)},"DataURL")},readAsArrayBuffer:function(e,t){q(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),q(e,n,"Text",t)},toDataURL:function(e,t){return"string"==typeof e?e:e.toDataURL?e.toDataURL(t||"image/png"):void 0},toBinaryString:function(e){return i.atob(H.toDataURL(e).replace(x,""))},readAsImage:function(n,a,t){if(H.isFile(n))if(s){var e=s.createObjectURL(n);e===o?O(n,a,"error"):H.readAsImage(e,a,t)}else H.readAsDataURL(n,function(e){"load"==e.type?H.readAsImage(e.result,a,t):(t||"error"==e.type)&&O(n,a,e,null,{loaded:e.loaded,total:e.total})});else if(H.isCanvas(n))O(n,a,"load",n);else if(y.test(n.nodeName))if(n.complete)O(n,a,"load",n);else{var i="error abort load";j(n,i,function e(t){"load"==t.type&&s&&s.revokeObjectURL(n.src),S(n,i,e),O(n,a,t,n)})}else if(n.iframe)O(n,a,{type:"error"});else{var r=H.newImage(n.dataURL||n);H.readAsImage(r,a,t)}},checkFileObj:function(e){var n={},t=H.accept;return"object"==typeof e?n=e:n.name=(e+"").split(/\\|\//g).pop(),null==n.type&&(n.type=n.name.split(".").pop()),k(t,function(e,t){((e=new RegExp(e.replace(/\s/g,"|"),"i")).test(n.type)||H.ext2mime[n.type])&&(n.type=H.ext2mime[n.type]||t.split("/")[0]+"/"+n.type)}),n},getDropFiles:function(e,t){var n=[],a=G(e),i=U(a.items)&&a.items[0]&&X(a.items[0]),r=H.queue(function(){t(n)});k((i?a.items:a.files)||[],function(t){r.inc();try{i?function t(n,a){if(n)if(n.isFile)n.file(function(e){e.fullPath=n.fullPath,a(!1,[e])},function(e){a("FileError.code: "+e.code)});else if(n.isDirectory){var e=n.createReader(),i=[];e.readEntries(function(e){H.afor(e,function(n,e){t(e,function(e,t){e?H.log(e):i=i.concat(t),n?n():a(!1,i)})})},function(e){a("directory_reader: "+e)})}else t(X(n),a);else a("invalid entry")}(t,function(e,t){e?H.log("[err] getDropFiles:",e):n.push.apply(n,t),r.next()}):function(e,n){if(!e.type&&e.size%4096==0&&e.size<=102400)if(u)try{var a=new u;j(a,C,function(e){var t="error"!=e.type;n(t),t&&a.abort()}),a.readAsDataURL(e)}catch(e){n(!1)}else n(null);else n(!0)}(t,function(e){e&&n.push(t),r.next()})}catch(e){r.next(),H.log("[err] getDropFiles: ",e)}}),r.check()},getFiles:function(e,t,n){var a=[];return n?(H.filterFiles(H.getFiles(e),t,n),null):(e.jquery&&(e.each(function(){a=a.concat(H.getFiles(this))}),e=a,a=[]),"string"==typeof t&&(t=H.getFilesFilter(t)),e.originalEvent?e=z(e.originalEvent):e.srcElement&&(e=z(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?(a=e.files,p||(a[0].blob=e,a[0].iframe=!0)):!p&&W(e)?H.trim(e.value)&&((a=[H.checkFileObj(e.value)])[0].blob=e,a[0].iframe=!0):U(e)&&(a=e),H.filter(a,function(e){return!t||t.test(e.name)}))},getTotalSize:function(e){for(var t=0,n=e&&e.length;n--;)t+=e[n].size;return t},getInfo:function(t,a){var i={},r=_.concat();H.isFile(t)?function n(){var e=r.shift();e?e.test(t.type)?e(t,function(e,t){e?a(e):(L(i,t),n())}):n():a(!1,i)}():a("not_support_info",i)},addInfoReader:function(t,e){e.test=function(e){return t.test(e)},_.push(e)},filter:function(e,t){for(var n,a=[],i=0,r=e.length;i<r;i++)i in e&&(n=e[i],t.call(n,n,i,e)&&a.push(n));return a},filterFiles:function(e,a,t){if(e.length){var i,r=e.concat(),o=[],s=[];!function n(){r.length?(i=r.shift(),H.getInfo(i,function(e,t){(a(i,!e&&t)?o:s).push(i),n()})):t(o,s)}()}else t([],e)},upload:function(s){(s=L({jsonp:"callback",prepare:H.F,beforeupload:H.F,upload:H.F,fileupload:H.F,fileprogress:H.F,filecomplete:H.F,progress:H.F,complete:H.F,pause:H.F,imageOriginal:!0,chunkSize:H.chunkSize,chunkUploadRetry:H.chunkUploadRetry,uploadRetry:H.uploadRetry},s)).imageAutoOrientation&&!s.imageTransform&&(s.imageTransform={rotate:"auto"});var l,u=new H.XHR(s),c=this._getFilesDataArray(s.files),f=this,d=0,p=0,h=!1;return k(c,function(e){d+=e.size}),u.files=[],k(c,function(e){u.files.push(e.file)}),u.total=d,u.loaded=0,u.filesLeft=c.length,s.beforeupload(u,s),l=function(){var n,a=c.shift(),i=a&&a.file,r=!1,o=(n={},k(s,function(e,t){e&&"object"==typeof e&&void 0===e.nodeType&&(e=L({},e)),n[t]=e}),n);if(u.filesLeft=c.length,i&&i.name===H.expando&&(i=null,H.log("[warn] FileAPI.upload() â€” called without files")),("abort"!=u.statusText||u.current)&&a){if(h=!1,(u.currentFile=i)&&!1===s.prepare(i,o))return void l.call(f);o.file=i,f._getFormData(o,a,function(e){p||s.upload(u,s);var t=new H.XHR(L({},o,{upload:i?function(){s.fileupload(i,t,o)}:m,progress:i?function(e){r||(r=e.loaded===e.total,s.fileprogress({type:"progress",total:a.total=e.total,loaded:a.loaded=e.loaded},i,t,o),s.progress({type:"progress",total:d,loaded:u.loaded=p+a.size*(e.loaded/e.total)|0},i,t,o))}:m,complete:function(e){k(P,function(e){u[e]=t[e]}),i&&(a.total=a.total||a.size,a.loaded=a.total,e||(this.progress(a),r=!0,p+=a.size,u.loaded=p),s.filecomplete(e,t,i,o)),setTimeout(function(){l.call(f)},0)}}));u.abort=function(e){e||(c.length=0),this.current=e,t.abort()},t.send(e)})}else{var e=200==u.status||201==u.status||204==u.status;s.complete(!e&&(u.statusText||"error"),u,s),h=!0}},setTimeout(l,0),u.append=function(e,t){e=H._getFilesDataArray([].concat(e)),k(e,function(e){d+=e.size,u.files.push(e.file),t?c.unshift(e):c.push(e)}),u.statusText="",h&&l.call(f)},u.remove=function(e){for(var t,n=c.length;n--;)c[n].file==e&&(t=c.splice(n,1),d-=t.size);return t},u},_getFilesDataArray:function(e){var a=[],t={};if(W(e)){var n=H.getFiles(e);t[e.name||"file"]=null!==e.getAttribute("multiple")?n:n[0]}else U(e)&&W(e[0])?k(e,function(e){t[e.name||"file"]=H.getFiles(e)}):t=e;return k(t,function t(e,n){U(e)?k(e,function(e){t(e,n)}):e&&(e.name||e.image)&&a.push({name:n,file:e,size:e.size,total:e.size,loaded:0})}),a.length||a.push({file:{name:H.expando}}),a},_getFormData:function(i,e,t){var n=e.file,r=e.name,o=n.name,s=n.type,l=H.support.transform&&i.imageTransform,u=new H.Form,c=H.queue(function(){t(u)}),f=l&&function(e){var t;for(t in e)if(e.hasOwnProperty(t)&&!(e[t]instanceof Object||"overlay"===t||"filter"===t))return!0;return!1}(l),d=H.postNameConcat;k(i.data,function n(e,a){"object"==typeof e?k(e,function(e,t){n(e,d(a,t))}):u.append(a,e)}),function n(a){a.image?(c.inc(),a.toData(function(e,t){o=o||(new Date).getTime()+".png",n(t),c.next()})):H.Image&&l&&(/^image/.test(a.type)||b.test(a.nodeName))?(c.inc(),f&&(l=[l]),H.Image.transform(a,l,i.imageAutoOrientation,function(e,t){if(f&&!e)v||H.flashEngine||(u.multipart=!0),u.append(r,t[0],o,l[0].type||s);else{var n=0;e||k(t,function(e,t){v||H.flashEngine||(u.multipart=!0),l[t].postName||(n=1),u.append(l[t].postName||d(r,t),e,o,l[t].type||s)}),(e||i.imageOriginal)&&u.append(d(r,n?"original":null),a,o,s)}c.next()})):o!==H.expando&&u.append(r,a,o)}(n),c.check()},reset:function(n,e){var t,a;return d?(a=d(n).clone(!0).insertBefore(n).val("")[0],e||d(n).remove()):(t=n.parentNode,(a=t.insertBefore(n.cloneNode(!0),n)).value="",e||t.removeChild(n),k(T[H.uid(n)],function(e,t){k(e,function(e){S(n,t,e),B(a,t,e)})})),a},load:function(t,n){var a=H.getXHR();return a?(a.open("GET",t,!0),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),B(a,"progress",function(e){e.lengthComputable&&n({type:e.type,loaded:e.loaded,total:e.total},a)}),a.onreadystatechange=function(){if(4==a.readyState)if(a.onreadystatechange=null,200==a.status){var e={name:(t=t.split("/"))[t.length-1],size:a.getResponseHeader("Content-Length"),type:a.getResponseHeader("Content-Type")};e.dataURL="data:"+e.type+";base64,"+H.encode64(a.responseBody||a.responseText),n({type:"load",result:e},a)}else n({type:"error"},a)},a.send(null)):n({type:"error"}),a},encode64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",a=0;for("string"!=typeof e&&(e=String(e));a<e.length;){var i,r,o=255&e.charCodeAt(a++),s=255&e.charCodeAt(a++),l=255&e.charCodeAt(a++),u=o>>2,c=(3&o)<<4|s>>4;isNaN(s)?i=r=64:(i=(15&s)<<2|l>>6,r=isNaN(l)?64:63&l),n+=t.charAt(u)+t.charAt(c)+t.charAt(i)+t.charAt(r)}return n}};function O(e,t,n,a,i){var r={type:n.type||n,target:e,result:a};L(r,i),t(r)}function N(e){return u&&!!u.prototype["readAs"+e]}function q(a,i,e,t){if(H.isBlob(a)&&N(e)){var r=new u;B(r,C,function e(t){var n=t.type;"progress"==n?O(a,i,t,t.target.result,{loaded:t.loaded,total:t.total}):"loadend"==n?(S(r,C,e),r=null):O(a,i,t,t.target.result)});try{t?r["readAs"+e](a,t):r["readAs"+e](a)}catch(e){O(a,i,"error",o,{error:e.toString()})}}else O(a,i,"error",o,{error:"FileReader_not_support_"+e})}function X(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function W(e){return A.test(e&&e.tagName)}function G(e){return(e.originalEvent||e||"").dataTransfer||{}}H.addInfoReader(/^image/,function(e,t){if(!e.__dimensions){var n=e.__dimensions=H.defer();H.readAsImage(e,function(e){var t=e.target;n.resolve("load"!=e.type&&"error",{width:t.width,height:t.height}),t.src=H.EMPTY_PNG,t=null})}e.__dimensions.then(t)}),H.event.dnd=function(e,i,n){var r,o;n||(n=i,i=H.F),u?(B(e,"dragenter dragleave dragover",i.ff=i.ff||function(e){for(var t=G(e).types,n=t&&t.length,a=!1;n--;)if(~t[n].indexOf("File")){e[D](),o!==e.type&&("dragleave"!=(o=e.type)&&i.call(e[E],!0,e),a=!0);break}a&&(clearTimeout(r),r=setTimeout(function(){i.call(e[E],"dragleave"!=o,e)},50))}),B(e,"drop",n.ff=n.ff||function(t){t[D](),o=0,i.call(t[E],!1,t),H.getDropFiles(t,function(e){n.call(t[E],e,t)})})):H.log("Drag'n'Drop -- not supported")},H.event.dnd.off=function(e,t,n){S(e,"dragenter dragleave dragover",t.ff),S(e,"drop",n.ff)},d&&!d.fn.dnd&&(d.fn.dnd=function(e,t){return this.each(function(){H.event.dnd(this,e,t)})},d.fn.offdnd=function(e,t){return this.each(function(){H.event.dnd.off(this,e,t)})}),i.FileAPI=L(H,i.FileAPI),H.log("FileAPI: "+H.version),H.log("protocol: "+i.location.protocol),H.log("doctype: ["+e.name+"] "+e.publicId+" "+e.systemId),k(a.getElementsByTagName("meta"),function(e){/x-ua-compatible/i.test(e.getAttribute("http-equiv"))&&H.log("meta.http-equiv: "+e.getAttribute("content"))});try{H._supportConsoleLog=!!console.log,H._supportConsoleLogApply=!!console.log.apply}catch(e){}H.flashUrl||(H.flashUrl=H.staticPath+"FileAPI.flash.swf"),H.flashImageUrl||(H.flashImageUrl=H.staticPath+"FileAPI.flash.image.swf"),H.flashWebcamUrl||(H.flashWebcamUrl=H.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(y,n,e){"use strict";var w=Math.min,f=Math.round,b=function(){return n.createElement("canvas")},t=!1,r={8:270,3:180,6:90,7:270,4:180,5:90};try{t=-1<b().toDataURL("image/png").indexOf("data:image/png")}catch(e){}function A(e){if(e instanceof A){var t=new A(e.file);return y.extend(t.matrix,e.matrix),t}if(!(this instanceof A))return new A(e);this.file=e,this.size=e.size||100,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0}}A.prototype={image:!0,constructor:A,set:function(e){return y.extend(this.matrix,e),this},crop:function(e,t,n,a){return void 0===n&&(n=e,a=t,e=t=0),this.set({sx:e,sy:t,sw:n,sh:a||n})},resize:function(e,t,n){return/min|max/.test(t)&&(n=t,t=e),this.set({dw:e,dh:t||e,resize:n})},preview:function(e,t){return this.resize(e,t||e,"preview")},rotate:function(e){return this.set({deg:e})},filter:function(e){return this.set({filter:e})},overlay:function(e){return this.set({overlay:e})},clone:function(){return new A(this)},_load:function(e,t){var n=this;/img|video/i.test(e.nodeName)?t.call(n,null,e):y.readAsImage(e,function(e){t.call(n,"load"!=e.type,e.result)})},_apply:function(e,t){var n,a=b(),i=this.getMatrix(e),l=a.getContext("2d"),r=e.videoWidth||e.width,o=e.videoHeight||e.height,s=i.deg,u=i.dw,c=i.dh,f=r,d=o,p=i.filter,h=e,m=i.overlay,g=y.queue(function(){e.src=y.EMPTY_PNG,t(!1,a)}),v=y.renderImageToCanvas;for(s-=360*Math.floor(s/360),e._type=this.file.type;i.multipass&&2<w(f/u,d/c);)f=f/2+.5|0,d=d/2+.5|0,(n=b()).width=f,n.height=d,h!==e?(v(n,h,0,0,h.width,h.height,0,0,f,d),h=n):(v(h=n,e,i.sx,i.sy,i.sw,i.sh,0,0,f,d),i.sx=i.sy=i.sw=i.sh=0);a.width=s%180?c:u,a.height=s%180?u:c,a.type=i.type,a.quality=i.quality,l.rotate(s*Math.PI/180),v(l.canvas,h,i.sx,i.sy,i.sw||h.width,i.sh||h.height,180==s||270==s?-u:0,90==s||180==s?-c:0,u,c),u=a.width,c=a.height,m&&y.each([].concat(m),function(r){g.inc();var o=new window.Image,s=function(){var e=0|r.x,t=0|r.y,n=r.w||o.width,a=r.h||o.height,i=r.rel;e=1==i||4==i||7==i?(u-n+e)/2:2==i||5==i||8==i?u-(n+e):e,t=3==i||4==i||5==i?(c-a+t)/2:6<=i?c-(a+t):t,y.event.off(o,"error load abort",s);try{l.globalAlpha=r.opacity||1,l.drawImage(o,e,t,n,a)}catch(e){}g.next()};y.event.on(o,"error load abort",s),o.src=r.src,o.complete&&s()}),p&&(g.inc(),A.applyFilter(a,p,g.next)),g.check()},getMatrix:function(e){var t,n,a=y.extend({},this.matrix),i=a.sw=a.sw||e.videoWidth||e.naturalWidth||e.width,r=a.sh=a.sh||e.videoHeight||e.naturalHeight||e.height,o=a.dw=a.dw||i,s=a.dh=a.dh||r,l=i/r,u=o/s,c=a.resize;"preview"==c?o==i&&s==r||(l<=u?n=(t=i)/u:t=(n=r)*u,t==i&&n==r||(a.sx=~~((i-t)/2),a.sy=~~((r-n)/2),i=t,r=n)):c&&(s=o<i||s<r?"min"==c?(o=f(l<u?w(i,o):s*l),f(l<u?o/l:w(r,s))):(o=f(u<=l?w(i,o):s*l),f(u<=l?o/l:w(r,s))):(o=i,r));return a.sw=i,a.sh=r,a.dw=o,a.dh=s,a.multipass=y.multiPassResize,a},_trans:function(n){this._load(this.file,function(e,t){if(e)n(e);else try{this._apply(t,n)}catch(e){y.log("[err] FileAPI.Image.fn._apply:",e),n(e)}})},get:function(n){if(y.support.transform){var a=this,i=a.matrix;"auto"==i.deg?y.getInfo(a.file,function(e,t){i.deg=r[t&&t.exif&&t.exif.Orientation]||0,a._trans(n)}):a._trans(n)}else n("not_support_transform");return this},toData:function(e){return this.get(e)}},A.exifOrientation=r,A.transform=function(l,t,u,n){function e(e,r){var o={},s=y.queue(function(e){n(e,o)});e?s.fail():y.each(t,function(e,n){if(!s.isFail()){var t=new A(r.nodeType?r:l),a="function"==typeof e;if(a?e(r,t):e.width?t[e.preview?"preview":"resize"](e.width,e.height,e.strategy):e.maxWidth&&(r.width>e.maxWidth||r.height>e.maxHeight)&&t.resize(e.maxWidth,e.maxHeight,"max"),e.crop){var i=e.crop;t.crop(0|i.x,0|i.y,i.w||i.width,i.h||i.height)}void 0===e.rotate&&u&&(e.rotate="auto"),t.set({type:t.matrix.type||e.type||l.type||"image/png"}),a||t.set({deg:e.rotate,overlay:e.overlay,filter:e.filter,quality:e.quality||1}),s.inc(),t.toData(function(e,t){e?s.fail():(o[n]=t,s.next())})}})}l.width?e(!1,l):y.getInfo(l,e)},y.each(["TOP","CENTER","BOTTOM"],function(n,a){y.each(["LEFT","CENTER","RIGHT"],function(e,t){A[n+"_"+e]=3*a+t,A[e+"_"+n]=3*a+t})}),A.toCanvas=function(e){var t=n.createElement("canvas");return t.width=e.videoWidth||e.width,t.height=e.videoHeight||e.height,t.getContext("2d").drawImage(e,0,0),t},A.fromDataURL=function(e,t,n){var a=y.newImage(e);y.extend(a,t),n(a)},A.applyFilter=function(e,t,n){"function"==typeof t?t(e,n):window.Caman&&window.Caman("IMG"==e.tagName?A.toCanvas(e):e,function(){"string"==typeof t?this[t]():y.each(t,function(e,t){this[t](e)},this),this.render(n)})},y.renderImageToCanvas=function(e,t,n,a,i,r,o,s,l,u){try{return e.getContext("2d").drawImage(t,n,a,i,r,o,s,l,u)}catch(e){throw y.log("renderImageToCanvas failed"),e}},y.support.canvas=y.support.transform=t,y.Image=A}(FileAPI,document),function(e){"use strict";!function(y){if(!window.navigator||!window.navigator.platform||!/iP(hone|od|ad)/.test(window.navigator.platform))return;var w=y.renderImageToCanvas;y.detectSubsampling=function(e){var t,n;return 1048576<e.width*e.height&&((t=document.createElement("canvas")).width=t.height=1,(n=t.getContext("2d")).drawImage(e,1-e.width,0),0===n.getImageData(0,0,1,1).data[3])},y.detectVerticalSquash=function(e,t){var n,a,i,r,o=e.naturalHeight||e.height,s=document.createElement("canvas"),l=s.getContext("2d");for(t&&(o/=2),s.width=1,s.height=o,l.drawImage(e,0,0),n=l.getImageData(0,0,1,o).data,a=0,r=i=o;a<r;)0===n[4*(r-1)+3]?i=r:a=r,r=i+a>>1;return r/o||1},y.renderImageToCanvas=function(e,t,n,a,i,r,o,s,l,u){if("image/jpeg"===t._type){var c,f,d,p,h=e.getContext("2d"),m=document.createElement("canvas"),g=1024,v=m.getContext("2d");if(m.width=g,m.height=g,h.save(),(c=y.detectSubsampling(t))&&(n/=2,a/=2,i/=2,r/=2),f=y.detectVerticalSquash(t,c),c||1!==f){for(a*=f,l=Math.ceil(g*l/i),u=Math.ceil(g*u/r/f),p=s=0;p<r;){for(d=o=0;d<i;)v.clearRect(0,0,g,g),v.drawImage(t,n,a,i,r,-d,-p,i,r),h.drawImage(m,0,0,g,g,o,s,l,u),d+=g,o+=l;p+=g,s+=u}return h.restore(),e}}return w(e,t,n,a,i,r,o,s,l,u)}}(FileAPI)}(),function(u,e){"use strict";var i=e.document,n=e.FormData,t=function(){this.items=[]},r=e.encodeURIComponent;function o(t,n,e){var a=t.blob,i=t.file;if(i){if(!a.toDataURL)return void u.readAsBinaryString(a,function(e){"load"==e.type&&n(t,e.result)});var r={"image/jpeg":".jpe?g","image/png":".png"},o=r[t.type]?t.type:"image/png",s=r[o]||".png",l=a.quality||1;i.match(new RegExp(s+"$","i"))||(i+=s.replace("?","")),t.file=i,t.type=o,!e&&a.toBlob?a.toBlob(function(e){n(t,e)},o,l):n(t,u.toBinaryString(a.toDataURL(o,l)))}else n(t,a)}t.prototype={append:function(e,t,n,a){this.items.push({name:e,blob:t&&t.blob||(null==t?"":t),file:t&&(n||t.name),type:t&&(a||t.type)})},each:function(e){for(var t=0,n=this.items.length;t<n;t++)e.call(this,this.items[t])},toData:function(e,t){t._chunked=u.support.chunked&&0<t.chunkSize&&1==u.filter(this.items,function(e){return e.file}).length,u.support.html5?u.formData&&!this.multipart&&n?t._chunked?(u.log("FileAPI.Form.toPlainData"),this.toPlainData(e)):(u.log("FileAPI.Form.toFormData"),this.toFormData(e)):(u.log("FileAPI.Form.toMultipartData"),this.toMultipartData(e)):(u.log("FileAPI.Form.toHtmlData"),this.toHtmlData(e))},_to:function(t,e,n,a){var i=u.queue(function(){e(t)});this.each(function(e){n(e,t,i,a)}),i.check()},toHtmlData:function(e){this._to(i.createDocumentFragment(),e,function(e,t){var n,a=e.blob;e.file?(u.reset(a,!0),a.name=e.name,a.disabled=!1,t.appendChild(a)):((n=i.createElement("input")).name=e.name,n.type="hidden",n.value=a,t.appendChild(n))})},toPlainData:function(e){this._to({},e,function(e,n,a){e.file&&(n.type=e.file),e.blob.toBlob?(a.inc(),o(e,function(e,t){n.name=e.name,n.file=t,n.size=t.length,n.type=e.type,a.next()})):e.file?(n.name=e.blob.name,n.file=e.blob,n.size=e.blob.size,n.type=e.type):(n.params||(n.params=[]),n.params.push(r(e.name)+"="+r(e.blob))),n.start=-1,n.end=n.file&&n.file.FileAPIReadPosition||-1,n.retry=0})},toFormData:function(e){this._to(new n,e,function(e,n,a){e.blob&&e.blob.toBlob?(a.inc(),o(e,function(e,t){n.append(e.name,t,e.file),a.next()})):e.file?n.append(e.name,e.blob,e.file):n.append(e.name,e.blob),e.file&&n.append("_"+e.name,e.file)})},toMultipartData:function(e){this._to([],e,function(e,n,a,i){a.inc(),o(e,function(e,t){n.push("--_"+i+'\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+r(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n\r\n"+(e.file?t:r(t))+"\r\n"),a.next()},!0)},u.expando)}},u.Form=t}(FileAPI,window),function(g,v){"use strict";var i=function(){},y=g.document,e=function(e){this.uid=v.uid(),this.xhr={abort:i,getResponseHeader:i,getAllResponseHeaders:i},this.options=e},w={"":1,XML:1,Text:1,Body:1};e.prototype={status:0,statusText:"",constructor:e,getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(e,t){var n=this,a=n.options;n.end=n.abort=i,n.status=e,t&&(n.statusText=t),v.log("xhr.end:",e,t),a.complete(200!=e&&201!=e&&(n.statusText||"unknown"),n),n.xhr&&n.xhr.node&&setTimeout(function(){var e=n.xhr.node;try{e.parentNode.removeChild(e)}catch(e){}try{delete g[n.uid]}catch(e){}g[n.uid]=n.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData(function(e){n.upload(n,t),t._send.call(t,n,e)},n)},_send:function(a,i){var r,o=this,s=o.uid,l=o.uid+"Load",n=a.url;if(v.log("XHR._send:",i),a.cache||(n+=(~n.indexOf("?")?"&":"?")+v.uid()),i.nodeName){var e=a.jsonp;n=n.replace(/([a-z]+)=(\?)/i,"$1="+s),a.upload(a,o);var u=function(e){if(~n.indexOf(e.origin))try{var t=v.parseJSON(e.data);t.id==s&&c(t.status,t.statusText,t.response)}catch(e){c(0,e.message)}},c=g[s]=function(e,t,n){o.readyState=4,o.responseText=n,o.end(e,t),v.event.off(g,"message",u),g[s]=r=f=g[l]=null};o.xhr.abort=function(){try{f.stop?f.stop():f.contentWindow.stop?f.contentWindow.stop():f.contentWindow.document.execCommand("Stop")}catch(e){}c(0,"abort")},v.event.on(g,"message",u),g[l]=function(){try{var e=f.contentWindow,t=e.document,n=e.result||v.parseJSON(t.body.innerHTML);c(n.status,n.statusText,n.response)}catch(e){v.log("[transport.onload]",e)}},(r=y.createElement("div")).innerHTML='<form target="'+s+'" action="'+n+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+s+'" src="javascript:false;" onload="'+l+'()"></iframe>'+(e&&a.url.indexOf("=?")<0?'<input value="'+s+'" name="'+e+'" type="hidden"/>':"")+"</form>";var t=r.getElementsByTagName("form")[0],f=r.getElementsByTagName("iframe")[0];t.appendChild(i),v.log(t.parentNode.innerHTML),y.body.appendChild(r),o.xhr.node=r,o.readyState=2,t.submit(),t=null}else{if(n=n.replace(/([a-z]+)=(\?)&?/i,""),this.xhr&&this.xhr.aborted)return void v.log("Error: already aborted");if(r=o.xhr=v.getXHR(),i.params&&(n+=(n.indexOf("?")<0?"?":"&")+i.params.join("&")),r.open("POST",n,!0),v.withCredentials&&(r.withCredentials="true"),a.headers&&a.headers["X-Requested-With"]||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),v.each(a.headers,function(e,t){r.setRequestHeader(t,e)}),a._chunked){r.upload&&r.upload.addEventListener("progress",v.throttle(function(e){i.retry||a.progress({type:e.type,total:i.size,loaded:i.start+e.loaded,totalSize:i.size},o,a)},100),!1),r.onreadystatechange=function(){var e=parseInt(r.getResponseHeader("X-Last-Known-Byte"),10);if(o.status=r.status,o.statusText=r.statusText,o.readyState=r.readyState,4==r.readyState){try{for(var t in w)o["response"+t]=r["response"+t]}catch(e){}if(r.onreadystatechange=null,!r.status||0<r.status-201)if(v.log("Error: "+r.status),(!r.status&&!r.aborted||500==r.status||416==r.status)&&++i.retry<=a.chunkUploadRetry){var n=r.status?0:v.chunkNetworkDownRetryTimeout;a.pause(i.file,a),v.log("X-Last-Known-Byte: "+e),e?i.end=e:(i.end=i.start-1,416==r.status&&(i.end=i.end-a.chunkSize)),setTimeout(function(){o._send(a,i)},n)}else o.end(r.status);else i.retry=0,i.end==i.size-1?o.end(r.status):(v.log("X-Last-Known-Byte: "+e),e&&(i.end=e),i.file.FileAPIReadPosition=i.end,setTimeout(function(){o._send(a,i)},0));r=null}},i.start=i.end+1,i.end=Math.max(Math.min(i.start+a.chunkSize,i.size)-1,i.start);var d=i.file,p=(d.slice||d.mozSlice||d.webkitSlice).call(d,i.start,i.end+1);i.size&&!p.size?setTimeout(function(){o.end(-1)}):(r.setRequestHeader("Content-Range","bytes "+i.start+"-"+i.end+"/"+i.size),r.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(i.name)),r.setRequestHeader("Content-Type",i.type||"application/octet-stream"),r.send(p)),d=p=null}else if(r.upload&&r.upload.addEventListener("progress",v.throttle(function(e){a.progress(e,o,a)},100),!1),r.onreadystatechange=function(){if(o.status=r.status,o.statusText=r.statusText,o.readyState=r.readyState,4==r.readyState){for(var e in w)o["response"+e]=r["response"+e];if(r.onreadystatechange=null,!r.status||201<r.status)if(v.log("Error: "+r.status),(!r.status&&!r.aborted||500==r.status)&&(a.retry||0)<a.uploadRetry){a.retry=(a.retry||0)+1;var t=v.networkDownRetryTimeout;a.pause(a.file,a),setTimeout(function(){o._send(a,i)},t)}else o.end(r.status);else o.end(r.status);r=null}},v.isArray(i)){r.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+v.expando);var h=i.join("")+"--_"+v.expando+"--";if(r.sendAsBinary)r.sendAsBinary(h);else{var m=Array.prototype.map.call(h,function(e){return 255&e.charCodeAt(0)});r.send(new Uint8Array(m).buffer)}}else r.send(i)}}},v.XHR=e}(window,FileAPI),function(r,o){"use strict";var s=r.URL||r.webkitURL,l=r.document,e=r.navigator,u=e.getUserMedia||e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia,c=!!u;o.support.media=c;var f=function(e){this.video=e};f.prototype={isActive:function(){return!!this._active},start:function(t){var n,a,i=this,r=i.video,o=function(e){i._active=!e,clearTimeout(a),clearTimeout(n),t&&t(e,i)};u.call(e,{video:!0},function(e){i.stream=e,r.src=s.createObjectURL(e),n=setInterval(function(){(function(e){var t,n=l.createElement("canvas"),a=!1;try{(t=n.getContext("2d")).drawImage(e,0,0,1,1),a=255!=t.getImageData(0,0,1,1).data[4]}catch(e){}return a})(r)&&o(null)},1e3),a=setTimeout(function(){o("timeout")},5e3),r.play()},o)},stop:function(){try{this._active=!1,this.video.pause(),this.stream.stop()}catch(e){}},shot:function(){return new t(this.video)}},f.get=function(e){return new f(e.firstChild)},f.publish=function(n,a,i){"function"==typeof a&&(i=a,a={}),a=o.extend({},{width:"100%",height:"100%",start:!0},a),n.jquery&&(n=n[0]);var e=function(e){if(e)i(e);else{var t=f.get(n);a.start?t.start(i):i(null,t)}};if(n.style.width=d(a.width),n.style.height=d(a.height),o.html5&&c){var t=l.createElement("video");t.style.width=d(a.width),t.style.height=d(a.height),r.jQuery?jQuery(n).empty():n.innerHTML="",n.appendChild(t),e()}else f.fallback(n,a,e)},f.fallback=function(e,t,n){n("not_support_camera")};var t=function(e){var t=e.nodeName?o.Image.toCanvas(e):e,n=o.Image(t);return n.type="image/png",n.width=t.width,n.height=t.height,n.size=t.width*t.height*4,n};function d(e){return 0<=e?e+"px":e}f.Shot=t,o.Camera=f}(window,FileAPI),function(i,o,g){"use strict";var v=i.document,y=i.location,w=i.navigator,b=g.each;g.support.flash=function(){var e=w.mimeTypes,t=!1;if(w.plugins&&"object"==typeof w.plugins["Shockwave Flash"])t=w.plugins["Shockwave Flash"].description&&!(e&&e["application/x-shockwave-flash"]&&!e["application/x-shockwave-flash"].enabledPlugin);else try{t=!(!i.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e){g.log("Flash -- does not supported.")}return t&&/^file:/i.test(y)&&g.log("[warn] Flash does not work on `file:` protocol."),t}(),g.support.flash&&(!g.html5||!g.support.html5||g.cors&&!g.support.cors||g.media&&!g.support.media)&&function(){var l=g.uid(),n=0,r={},a=/^https?:/i,u={_fn:{},publish:function(e,t,n){n=n||{},e.innerHTML=s({id:t,src:h(g.flashUrl,"r="+g.version),wmode:n.camera?"":"transparent",flashvars:"callback="+(n.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+t+"&storeKey="+w.userAgent.match(/\d/gi).join("")+"_"+g.version+(u.isReady||(g.pingUrl?"&ping="+g.pingUrl:""))+"&timeout="+g.flashAbortTimeout+(n.camera?"&useCamera="+h(g.flashWebcamUrl):"")+"&debug="+(g.debug?"1":"")})},init:function(){var e=v.body&&v.body.firstChild;if(e)do{if(1==e.nodeType){g.log("FlashAPI.state: awaiting");var t=v.createElement("div");return t.id="_"+l,c(t,{top:1,right:1,width:5,height:5,position:"absolute",zIndex:1e6+""}),e.parentNode.insertBefore(t,e),void u.publish(t,l)}}while(e=e.nextSibling);n<10&&setTimeout(u.init,50*++n)},ready:function(){g.log("FlashAPI.state: ready"),u.ready=g.F,u.isReady=!0,u.patch(),u.patchCamera&&u.patchCamera(),g.event.on(v,"mouseover",u.mouseover),g.event.on(v,"click",function(e){u.mouseover(e)&&(e.preventDefault?e.preventDefault():e.returnValue=!0)})},getEl:function(){return v.getElementById("_"+l)},getWrapper:function(e){do{if(/js-fileapi-wrapper/.test(e.className))return e}while((e=e.parentNode)&&e!==v.body)},disableMouseover:!1,mouseover:function(e){if(!u.disableMouseover){var t=g.event.fix(e).target;if(/input/i.test(t.nodeName)&&"file"==t.type&&!t.disabled){var n=t.getAttribute(l),a=u.getWrapper(t);if(g.multiFlash){if("i"==n||"r"==n)return!1;if("p"!=n){t.setAttribute(l,"i");var i=v.createElement("div");if(!a)return void g.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");c(i,{top:0,left:0,width:t.offsetWidth,height:t.offsetHeight,zIndex:1e6+"",position:"absolute"}),a.appendChild(i),u.publish(i,g.uid()),t.setAttribute(l,"p")}return!0}if(a){var r=function(e){e.getBoundingClientRect(),v.body,(e&&e.ownerDocument).documentElement;function t(e){var t,n;if(t=n=0,e.offsetParent)for(;t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;);return{left:t,top:n}}return{top:t(e).top,left:t(e).left,width:e.offsetWidth,height:e.offsetHeight}}(a);c(u.getEl(),r),u.curInp=t}}else/object|embed/i.test(t.nodeName)||c(u.getEl(),{top:1,left:1,width:5,height:5})}},onEvent:function(e){var t=e.type;if("ready"==t){try{u.getInput(e.flashId).setAttribute(l,"r")}catch(e){}return u.ready(),setTimeout(function(){u.mouseenter(e)},50),!0}"ping"===t?g.log("(flash -> js).ping:",[e.status,e.savedStatus],e.error):"log"===t?g.log("(flash -> js).log:",e.target):t in u&&setTimeout(function(){g.log("FlashAPI.event."+e.type+":",e),u[t](e)},1)},mouseDown:function(e){u.disableMouseover=!0},cancel:function(e){u.disableMouseover=!1},mouseenter:function(e){var t=u.getInput(e.flashId);if(t){u.cmd(e,"multiple",null!=t.getAttribute("multiple"));var n=[],a={};b((t.getAttribute("accept")||"").split(/,\s*/),function(e){g.accept[e]&&b(g.accept[e].split(" "),function(e){a[e]=1})}),b(a,function(e,t){n.push(t)}),u.cmd(e,"accept",n.length?n.join(",")+","+n.join(",").toUpperCase():"*")}},get:function(e){return v[e]||i[e]||v.embeds[e]},getInput:function(t){if(!g.multiFlash)return u.curInp;try{var e=u.getWrapper(u.get(t));if(e)return e.getElementsByTagName("input")[0]}catch(e){g.log('[err] Can not find "input" by flashId:',t,e)}},select:function(e){try{var t,n=u.getInput(e.flashId),a=g.uid(n),i=e.target.files;b(i,function(e){g.checkFileObj(e)}),r[a]=i,v.createEvent?((t=v.createEvent("Event")).files=i,t.initEvent("change",!0,!0),n.dispatchEvent(t)):o?o(n).trigger({type:"change",files:i}):((t=v.createEventObject()).files=i,n.fireEvent("onchange",t))}finally{u.disableMouseover=!1}},interval:null,cmd:function(e,t,n,a){u.uploadInProgress&&u.readInProgress?setTimeout(function(){u.cmd(e,t,n,a)},100):this.cmdFn(e,t,n,a)},cmdFn:function(t,n,a,i){try{return g.log("(js -> flash)."+n+":",a),u.get(t.flashId||t).cmd(n,a)}catch(e){g.log("(js -> flash).onError:",e),i||setTimeout(function(){u.cmd(t,n,a,!0)},50)}},patch:function(){g.flashEngine=!0,e(g,{readAsDataURL:function(a,i){f(a)?this.parent.apply(this,arguments):(g.log("FlashAPI.readAsBase64"),u.readInProgress=!0,u.cmd(a,"readAsBase64",{id:a.id,callback:d(function e(t,n){u.readInProgress=!1,p(e),g.log("FlashAPI.readAsBase64:",t),i({type:t?"error":"load",error:t,result:"data:"+a.type+";base64,"+n})})}))},readAsText:function(e,t,n){n?g.log("[warn] FlashAPI.readAsText not supported `encoding` param"):n=t,g.readAsDataURL(e,function(t){if("load"==t.type)try{t.result=i.atob(t.result.split(";base64,")[1])}catch(e){t.type="error",t.error=e.toString()}n(t)})},getFiles:function(e,t,n){if(n)return g.filterFiles(g.getFiles(e),t,n),null;var a=g.isArray(e)?e:r[g.uid(e.target||e.srcElement||e)];return a?(t&&(t=g.getFilesFilter(t),a=g.filter(a,function(e){return t.test(e.name)})),a):this.parent.apply(this,arguments)},getInfo:function(e,t){if(f(e))this.parent.apply(this,arguments);else if(e.isShot)t(null,e.info={width:e.width,height:e.height});else{if(!e.__info)(e.__info=g.defer()).resolve(null,e.info=null);e.__info.then(t)}}}),g.support.transform=!0,g.Image&&e(g.Image.prototype,{get:function(e,t){return this.set({scaleMode:t||"noScale"}),this.parent(e)},_load:function(t,n){if(g.log("FlashAPI.Image._load:",t),f(t))this.parent.apply(this,arguments);else{var a=this;g.getInfo(t,function(e){n.call(a,e,t)})}},_apply:function(a,i){if(g.log("FlashAPI.Image._apply:",a),f(a))this.parent.apply(this,arguments);else{var r=this.getMatrix(a.info),o=i;u.cmd(a,"imageTransform",{id:a.id,matrix:r,callback:d(function e(t,n){g.log("FlashAPI.Image._apply.callback:",t),p(e),t?o(t):g.support.html5||g.support.dataURI&&!(3e4<n.length)?(r.filter&&(o=function(e,t){e?i(e):g.Image.applyFilter(t,r.filter,function(){i(e,this.canvas)})}),g.newImage("data:"+a.type+";base64,"+n,o)):m({width:r.deg%180?r.dh:r.dw,height:r.deg%180?r.dw:r.dh,scale:r.scaleMode},n,o)})})}},toData:function(e){var t=this.file,n=t.info,a=this.getMatrix(n);g.log("FlashAPI.Image.toData"),f(t)?this.parent.apply(this,arguments):("auto"==a.deg&&(a.deg=g.Image.exifOrientation[n&&n.exif&&n.exif.Orientation]||0),e.call(this,!t.info,{id:t.id,flashId:t.flashId,name:t.name,type:t.type,matrix:a}))}}),g.Image&&e(g.Image,{fromDataURL:function(e,t,n){!g.support.dataURI||3e4<e.length?m(g.extend({scale:"exactFit"},t),e.replace(/^data:[^,]+,/,""),function(e,t){n(t)}):this.parent(e,t,n)}}),e(g.Form.prototype,{toData:function(e){for(var t=this.items,n=t.length;n--;)if(t[n].file&&f(t[n].blob))return this.parent.apply(this,arguments);g.log("FlashAPI.Form.toData"),e(t)}}),e(g.XHR.prototype,{_send:function(i,e){if(e.nodeName||e.append&&g.support.html5||g.isArray(e)&&"string"==typeof e[0])return this.parent.apply(this,arguments);var n,a,r={},o={},s=this;if(b(e,function(e){var t;e.file?(o[e.name]=e={id:(t=e.blob).id,name:t.name,matrix:t.matrix,flashId:t.flashId},a=e.id,n=e.flashId):r[e.name]=e.blob}),a||(n=l),!n)return g.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments);g.log("FlashAPI.XHR._send: "+n+" -> "+a),s.xhr={headers:{},abort:function(){u.uploadInProgress=!1,u.cmd(n,"abort",{id:a})},getResponseHeader:function(e){return this.headers[e]},getAllResponseHeaders:function(){return this.headers}};var t=g.queue(function(){u.uploadInProgress=!0,u.cmd(n,"upload",{url:h(i.url.replace(/([a-z]+)=(\?)&?/i,"")),data:r,files:a?o:null,headers:i.headers||{},callback:d(function e(t){var n=t.type,a=t.result;g.log("FlashAPI.upload."+n),"progress"==n?(t.loaded=Math.min(t.loaded,t.total),t.lengthComputable=!0,i.progress(t)):"complete"==n?(u.uploadInProgress=!1,p(e),"string"==typeof a&&(s.responseText=a.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),s.end(t.status||200)):"abort"!=n&&"error"!=n||(u.uploadInProgress=!1,s.end(t.status||0,t.message),p(e))})})});b(o,function(e){t.inc(),g.getInfo(e,t.next)}),t.check()}})}};function s(n){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(n.width||"100%")+'" height="'+(n.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(n.width||"100%")+'" height="'+(n.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,function(e,t){return n[t]})}function c(e,t){var n,a;if(e&&e.style)for(n in t){"number"==typeof(a=t[n])&&(a+="px");try{e.style[n]=a}catch(e){}}}function e(a,e){b(e,function(e,t){var n=a[t];a[t]=function(){return this.parent=n,e.apply(this,arguments)}})}function f(e){return e&&!e.flashId}function d(e){var t=e.wid=g.uid();return u._fn[t]=e,"FileAPI.Flash._fn."+t}function p(e){try{u._fn[e.wid]=null,delete u._fn[e.wid]}catch(e){}}function h(e,t){if(!a.test(e)){if(/^\.\//.test(e)||"/"!=e.charAt(0)){var n=y.pathname;e=((n=n.substr(0,n.lastIndexOf("/")))+"/"+e).replace("/./","/")}"//"!=e.substr(0,2)&&(e="//"+y.host+e),a.test(e)||(e=y.protocol+e)}return t&&(e+=(/\?/.test(e)?"&":"?")+t),e}function m(e,t,n){var a,i=g.uid(),r=v.createElement("div"),o=10;for(a in e)r.setAttribute(a,e[a]),r[a]=e[a];c(r,e),e.width="100%",e.height="100%",r.innerHTML=s(g.extend({id:i,src:h(g.flashImageUrl,"r="+g.uid()),wmode:"opaque",flashvars:"scale="+e.scale+"&callback="+d(function e(){return p(e),0<--o&&function(){try{var e=u.get(i);e.setImage(t)}catch(e){g.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',e)}}(),!0})},e)),n(!1,r),r=null}g.Flash=u,g.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(e,t){g.support.dataURI=!(1!=t.width||1!=t.height),u.init()})}()}(window,window.jQuery,FileAPI),function(e,t,s){"use strict";var n=s.each,a=[];s.support.flash&&s.media&&!s.support.media&&function(){function i(e){var t=e.wid=s.uid();return s.Flash._fn[t]=e,"FileAPI.Flash._fn."+t}function r(e){try{s.Flash._fn[e.wid]=null,delete s.Flash._fn[e.wid]}catch(e){}}var o=s.Flash;s.extend(s.Flash,{patchCamera:function(){s.Camera.fallback=function(e,t,n){var a=s.uid();s.log("FlashAPI.Camera.publish: "+a),o.publish(e,a,s.extend(t,{camera:!0,onEvent:i(function e(t){"camera"===t.type&&(r(e),t.error?(s.log("FlashAPI.Camera.publish.error: "+t.error),n(t.error)):(s.log("FlashAPI.Camera.publish.success: "+a),n(null)))})}))},n(a,function(e){s.Camera.fallback.apply(s.Camera,e)}),a=[],s.extend(s.Camera.prototype,{_id:function(){return this.video.id},start:function(n){var a=this;o.cmd(this._id(),"camera.on",{callback:i(function e(t){r(e),t.error?(s.log("FlashAPI.camera.on.error: "+t.error),n(t.error,a)):(s.log("FlashAPI.camera.on.success: "+a._id()),a._active=!0,n(null,a))})})},stop:function(){this._active=!1,o.cmd(this._id(),"camera.off")},shot:function(){s.log("FlashAPI.Camera.shot:",this._id());var e=s.Flash.cmd(this._id(),"shot",{});return e.type="image/png",e.flashId=this._id(),e.isShot=!0,new s.Camera.Shot(e)}})}}),s.Camera.fallback=function(){a.push(arguments)}}()}(window,window.jQuery,FileAPI),"function"==typeof define&&define.amd&&define("FileAPI",[],function(){return FileAPI});